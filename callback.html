<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Authenticating...</title>
</head>
<body>
    <p>Authenticating with SoundCloud...</p>
    <script>
        // In Implicit Grant, parameters are in the URL fragment (#)
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        
        const accessToken = params.get('access_token');
        const state = params.get('state');
        const expiresIn = params.get('expires_in');

        if (accessToken) {
            const channel = new BroadcastChannel('sc_auth_channel');
            channel.postMessage({ 
                type: 'oauth_token', 
                accessToken, 
                state, 
                expiresIn 
            });
            
            document.body.innerHTML = '<p>Success! You can close this window.</p>';
            setTimeout(() => window.close(), 1000);
        } else {
            // Check for errors in query params
            const queryParams = new URLSearchParams(window.location.search);
            const error = queryParams.get('error');
            if (error) {
                document.body.innerHTML = `<p style="color:red">Error: ${error}</p>`;
            }
        }
    </script>
</body>
</html>